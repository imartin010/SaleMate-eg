<!DOCTYPE html>
<html>
<head>
    <title>Admin Access Checker</title>
    <style>
        body { font-family: system-ui; padding: 40px; max-width: 800px; margin: 0 auto; }
        .info { background: #f0f9ff; border: 1px solid #0ea5e9; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .error { background: #fef2f2; border: 1px solid #ef4444; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .success { background: #f0fdf4; border: 1px solid #22c55e; padding: 20px; border-radius: 8px; margin: 20px 0; }
        pre { background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 8px; overflow-x: auto; }
        button { background: #3b82f6; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        button:hover { background: #2563eb; }
    </style>
</head>
<body>
    <h1>üîç Admin Access Diagnostic</h1>
    <p>This page checks your admin authentication status.</p>

    <button onclick="checkAuth()">Check My Admin Access</button>

    <div id="result"></div>

    <script>
        async function checkAuth() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>Checking...</p>';

            try {
                // Get localStorage data
                const localStorageKeys = Object.keys(localStorage);
                const authKey = localStorageKeys.find(k => k.includes('supabase.auth.token'));
                
                if (!authKey) {
                    result.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Not Logged In</h3>
                            <p>No authentication token found in localStorage.</p>
                            <p><strong>Action:</strong> Go to <a href="http://localhost:5174/auth/login">Login</a></p>
                        </div>
                    `;
                    return;
                }

                const authData = JSON.parse(localStorage.getItem(authKey));
                const accessToken = authData?.access_token;

                if (!accessToken) {
                    result.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Invalid Session</h3>
                            <p>Session found but no access token.</p>
                            <p><strong>Action:</strong> Logout and login again</p>
                        </div>
                    `;
                    return;
                }

                // Fetch profile from Supabase
                const response = await fetch('https://wkxbhvckmgrmdkdkhnqo.supabase.co/rest/v1/profiles?select=*', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indr...', // Get from your env
                        'Authorization': `Bearer ${accessToken}`,
                    }
                });

                const profiles = await response.json();
                
                if (response.ok && profiles.length > 0) {
                    const profile = profiles[0];
                    
                    const isAdmin = profile.role === 'admin';
                    
                    result.innerHTML = `
                        <div class="${isAdmin ? 'success' : 'error'}">
                            <h3>${isAdmin ? '‚úÖ Admin Access Confirmed' : '‚ùå Not an Admin'}</h3>
                            <p><strong>Name:</strong> ${profile.name}</p>
                            <p><strong>Email:</strong> ${profile.email}</p>
                            <p><strong>Role:</strong> ${profile.role}</p>
                            <p><strong>ID:</strong> ${profile.id}</p>
                            ${isAdmin ? 
                                '<p><strong>Action:</strong> You should be able to access <a href="/app/admin">Admin Panel</a></p>' :
                                '<p><strong>Action:</strong> Update your role to "admin" in Supabase profiles table</p>'
                            }
                        </div>
                        <div class="info">
                            <h4>Profile Data:</h4>
                            <pre>${JSON.stringify(profile, null, 2)}</pre>
                        </div>
                    `;

                    if (isAdmin) {
                        result.innerHTML += `
                            <div class="success">
                                <h4>‚úÖ Access Test</h4>
                                <p>Trying to access admin panel...</p>
                                <p><a href="/app/admin/dashboard" style="color: #2563eb; font-weight: bold;">Click here to access Admin Dashboard</a></p>
                            </div>
                        `;
                    } else {
                        result.innerHTML += `
                            <div class="error">
                                <h4>üîß Fix This:</h4>
                                <p>1. Go to <a href="https://supabase.com/dashboard/project/wkxbhvckmgrmdkdkhnqo/editor" target="_blank">Supabase Table Editor</a></p>
                                <p>2. Open "profiles" table</p>
                                <p>3. Find your user (${profile.email})</p>
                                <p>4. Change "role" from "${profile.role}" to "admin"</p>
                                <p>5. Logout and login again</p>
                            </div>
                        `;
                    }
                } else {
                    result.innerHTML = `
                        <div class="error">
                            <h3>‚ùå Profile Not Found</h3>
                            <p>Could not load profile from database.</p>
                            <pre>${JSON.stringify(profiles, null, 2)}</pre>
                        </div>
                    `;
                }

            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error</h3>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>

